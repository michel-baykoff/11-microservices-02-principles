# Домашнее задание к занятию «Микросервисы: принципы» -- Байков Михаил

Вы работаете в крупной компании, которая строит систему на основе микросервисной архитектуры.
Вам как DevOps-специалисту необходимо выдвинуть предложение по организации инфраструктуры для разработки и эксплуатации.

## Задача 1: API Gateway 

Предложите решение для обеспечения реализации API Gateway. Составьте сравнительную таблицу возможностей различных программных решений. На основе таблицы сделайте выбор решения.

Решение должно соответствовать следующим требованиям:
- маршрутизация запросов к нужному сервису на основе конфигурации,
- возможность проверки аутентификационной информации в запросах,
- обеспечение терминации HTTPS.

Обоснуйте свой выбор.

### Ответ 1

Проанализировав доступные решения можно выделить несколько потенциальных вариантов для использования в разработке и эксплуатации.

| Gateway/Требование  |  Kong | Nginx/Angie  |  Envoy | AWS API Gateway  | Traefik |
|---|---|---|---|---|---|
|  Маршрутизация |  на основе конфигурации | на основе конфигурации (крайне кастомизируемое решение)  | Очень кастомизируемая  |  встроенная |  автоматическая |
|  Аутентификация |  Присутствует (разные протоколы) | Присутствует (разные протоколы)  | Присутствует (разные протоколы)  |  Присутствует (разные протоколы) | Присутствует (разные протоколы)  |
| Терминация HTTPS  | да  | да  | да  | да  | да  |

Исходя из проведенного анализа я бы установил тестовые стенды для более плотного анализа с тремя вариантами: Nginx/Angie, Traefik и Kong. Все решения удовлетворяют требуемым критериям. Однако имеют свои плюсы и минусы которые стоит более плотно изучить совместно с разработчиками. Nginx/Angie наиболее кастомизируемое решение, но требует более высокой квалифиакции от команды эксплуатации, однако Angie является Российской разработкой и может иметь приоритеты в определенных случаях. Traefik более автоматизированное решение, но неизбежно с этим ограниченное в функционале. Kong выглядит более или менее сбалансированным решением. Что из этого предпочесть требует более детального анализа исходя из имеющихся человеческих ресурсов и их квалификации, а так же по согласованию с командой разработки.

## Задача 2: Брокер сообщений

Составьте таблицу возможностей различных брокеров сообщений. На основе таблицы сделайте обоснованный выбор решения.

Решение должно соответствовать следующим требованиям:
- поддержка кластеризации для обеспечения надёжности,
- хранение сообщений на диске в процессе доставки,
- высокая скорость работы,
- поддержка различных форматов сообщений,
- разделение прав доступа к различным потокам сообщений,
- простота эксплуатации.

Обоснуйте свой выбор.

### Ответ 2
| Брокер/Требование | Apache Kafka	| RabbitMQ | ActiveMQ | Redis Streams	| NATS |
|---|---|---|---|---|---|
|Кластеризация| да | да | да | да | да |
|Хранение на диске| да | да | да | да | нет |
|Скорость работы| Очень высокая | Высокая | Средняя | Высокая | Очень высокая |
|Форматы данных| Любой | Ограничен | Любой  | Любой | Ограничен |
|Контроль доступа| через ZooKeeper | AMQP 0.9.1 | JAAS/Kerberos | Ограниченный | JWT/JWT-HMAC |
|Простота эксплуатации| Средняя | Высокая | Средняя | Высокая | Очень высокая |

В результате анализа можно выделить несколько лидеров для использования в качестве брокера сообщений. Кафка, Рэббит и Редис. Это наиболее с моей точки зрения популярные решения в продакшене, плюс я на опыте сталкивался с разворачиванием, обслуживанием и поддержкой данных брокеров, а значит кроме соответствия критериям в них дополнительно гарантирован низкий time to production за счет имеющегося опыта. Вероятно стоит развернуть тестовые стенды с выделенными лидерами и провести более плотные эксперименты с командой разработки.
